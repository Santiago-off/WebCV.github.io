(()=>{const SITE_ID="VpmL6Rq6FiLK9L17N9nN";const CONFIG={"apiKey":"AIzaSyDH9sAkWdQHbPWjR27Hlh_ZvVjCoP8LEUc","authDomain":"panelweb-76d15.firebaseapp.com","projectId":"panelweb-76d15","storageBucket":"panelweb-76d15.firebasestorage.app","messagingSenderId":"456618044374","appId":"1:456618044374:web:e5a1e5c084cc165d695277"};const load=(src)=>new Promise((res,rej)=>{const s=document.createElement('script');s.src=src;s.async=true;s.onload=()=>res();s.onerror=()=>rej(new Error('load_fail:'+src));document.head.appendChild(s);});const postAll=(msg)=>{try{if(window.parent){window.parent.postMessage(msg,'*');}if(window.opener){window.opener.postMessage(msg,'*');}}catch(e){}};const safeSelect=(sel)=>{try{return document.querySelector(sel)||null;}catch(e){return null}};const applyCmd=(cmd)=>{try{if(!cmd||!cmd.type)return;switch(cmd.type){case 'PING':postAll({type:'PONG',siteId:SITE_ID});break;case 'SET_TEXT':{const el=safeSelect(cmd.selector);if(el){el.textContent=String(cmd.text||'');postAll({type:'ACK',siteId:SITE_ID,cmd:'SET_TEXT'})}break}case 'INJECT_HTML':{const el=safeSelect(cmd.selector);if(el){el.innerHTML=String(cmd.html||'');postAll({type:'ACK',siteId:SITE_ID,cmd:'INJECT_HTML'})}break}case 'ADD_CLASS':{const el=safeSelect(cmd.selector);if(el){el.classList.add(String(cmd.className||''));postAll({type:'ACK',siteId:SITE_ID,cmd:'ADD_CLASS'})}break}case 'REMOVE_CLASS':{const el=safeSelect(cmd.selector);if(el){el.classList.remove(String(cmd.className||''));postAll({type:'ACK',siteId:SITE_ID,cmd:'REMOVE_CLASS'})}break}default:postAll({type:'ERROR',siteId:SITE_ID,error:'unknown_cmd'})}}catch(e){postAll({type:'ERROR',siteId:SITE_ID,error:'cmd_exception'})}};window.addEventListener('message',(ev)=>{const data=ev&&ev.data;if(!data)return;if(data&&data.type==='PANEL_TO_CORE'&&data.siteId===SITE_ID){applyCmd(data.command)}});postAll({type:'PANEL_CORE_HANDSHAKE',siteId:SITE_ID,domain:location.hostname});const OVERLAY_ID='__panel_maintenance_overlay';const showOverlay=(txt)=>{let el=document.getElementById(OVERLAY_ID);if(!el){el=document.createElement('div');el.id=OVERLAY_ID;el.style.position='fixed';el.style.zIndex='2147483647';el.style.inset='0';el.style.background='#000';el.style.color='#fff';el.style.display='flex';el.style.alignItems='center';el.style.justifyContent='center';el.style.textAlign='center';el.style.padding='2rem';el.innerHTML='<div><h1 style="margin-bottom:1rem">Sitio en mantenimiento</h1><p>'+String(txt||'Estamos realizando mejoras. Vuelve m√°s tarde.')+'</p></div>';document.body.appendChild(el);}else{el.style.display='flex'}document.documentElement.style.overflow='hidden'};const hideOverlay=()=>{const el=document.getElementById(OVERLAY_ID);if(el){el.style.display='none'}document.documentElement.style.overflow=''};(async()=>{try{await load('https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js');await load('https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js');if(!window.firebase||!window.firebase.initializeApp)throw new Error('firebase_unavailable');window.firebase.initializeApp(CONFIG);const db=window.firebase.firestore();window.firebase.firestore&&window.firebase.firestore().enableIndexedDbPersistence&&window.firebase.firestore().enableIndexedDbPersistence().catch(()=>{});db.collection('publicSites').doc(SITE_ID).onSnapshot((snap)=>{const d=snap&&snap.data?snap.data():null;const status=d&&d.status?String(d.status):'online';if(status==='maintenance'){showOverlay(d&&d.message?d.message:null)}else{hideOverlay()}});}catch(e){postAll({type:'ERROR',siteId:SITE_ID,error:'core_init_failed'})}})();})();